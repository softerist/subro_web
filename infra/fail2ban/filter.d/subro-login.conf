# Fail2ban filter for Subro Web login brute force
# Matches failed login attempts and MFA failures
#
# Log format expected:
# 2026-01-05 10:15:30 SECURITY [FAILED_LOGIN] ip=192.168.1.100 email=te***@example.com reason=BAD_CREDENTIALS
# 2026-01-05 10:15:30 SECURITY [MFA_FAILED] ip=192.168.1.100 user_id=abc-123

[Definition]
# Must match the security logger timestamp format exactly
datepattern = ^%%Y-%%m-%%d %%H:%%M:%%S

# Match failed login attempts (bad credentials, inactive user, etc.)
# Match MFA verification failures
failregex = ^.* SECURITY \[FAILED_LOGIN\] ip=<HOST> .*$
            ^.* SECURITY \[MFA_FAILED\] ip=<HOST> .*$

ignoreregex =

[Init]
# No journalmatch - we use file-based logs
journalmatch =
