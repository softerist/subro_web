# Fail2ban filter for scanning/exploit attempts via Nginx access logs
# Catches path traversal, known exploit paths, suspicious methods
#
# Reads from Nginx access log (standard combined format)

[Definition]
# Uses built-in log format detection for Nginx
datepattern = {^LN-BEG}

failregex = ^<HOST> .* "(GET|POST|HEAD) [^"]*(\.\./|\.\.%%2[fF]|%%2e%%2e)[^"]*" .*$
            ^<HOST> .* "(GET|POST|HEAD) [^"]*(wp-admin|wp-login|phpmyadmin|/\.env|/\.git|/config\.|/backup)[^"]*" .*$
            ^<HOST> .* "(PROPFIND|TRACE|CONNECT) " .*$
            ^<HOST> .* "[^"]*" (400|405|444) .*$

# Don't match health checks or normal 404s for missing static files
ignoreregex = ^<HOST> .* "GET /health" .*$
              ^<HOST> .* "GET /favicon\.ico" .*$
              ^<HOST> .* "GET /robots\.txt" .*$

[Init]
journalmatch =
