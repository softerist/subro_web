# Fail2ban filter for Subro Web token/API key abuse
# Matches suspicious token attempts (malformed, bad signature) - NOT expired tokens
#
# Log format expected:
# 2026-01-05 10:15:30 SECURITY [BAD_TOKEN] ip=192.168.1.100 reason=malformed
# 2026-01-05 10:15:30 SECURITY [API_KEY_ABUSE] ip=192.168.1.100 key_prefix=abc12345

[Definition]
datepattern = ^%%Y-%%m-%%d %%H:%%M:%%S

# Only match truly malicious token patterns
# NOT: expired tokens (normal behavior)
# YES: malformed, bad_signature, invalid_audience
failregex = ^.* SECURITY \[BAD_TOKEN\] ip=<HOST> reason=(?:malformed|bad_signature|invalid_audience).*$
            ^.* SECURITY \[API_KEY_ABUSE\] ip=<HOST> .*$

ignoreregex =

[Init]
journalmatch =
