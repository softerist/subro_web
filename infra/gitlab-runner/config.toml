# GitLab Runner Configuration
# ============================
# Copy this file to /etc/gitlab-runner/config.toml on the runner machine
# After updating, restart the runner: sudo systemctl restart gitlab-runner
#
# Key settings explained:
# - concurrent: Maximum number of jobs that can run simultaneously
# - shutdown_timeout: Seconds to wait for jobs to complete before forcing shutdown (CRITICAL!)
# - request_concurrency: How many jobs a single runner can request at once
# - privileged: Required for Docker-in-Docker builds

concurrent = 8
check_interval = 0
connection_max_age = "15m0s"
shutdown_timeout = 300  # Give jobs 5 minutes to complete on shutdown/restart

[session_server]
  session_timeout = 1800

[[runners]]
  name = "MSI"
  request_concurrency = 4
  url = "https://gitlab.com/"
  # NOTE: These values are generated when you register the runner
  # Run: gitlab-runner register
  # id = <YOUR_RUNNER_ID>
  # token = "<YOUR_RUNNER_TOKEN>"
  executor = "docker"

  [runners.cache]
    MaxUploadedArchiveSize = 0
    [runners.cache.s3]
    [runners.cache.gcs]
    [runners.cache.azure]

  [runners.docker]
    tls_verify = false
    image = "alpine:latest"
    privileged = true
    disable_entrypoint_overwrite = false
    oom_kill_disable = false
    disable_cache = false
    volumes = ["/cache", "/certs/client", "/certs/server"]
    shm_size = 0
    network_mtu = 0
